<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Group Finder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">         
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <script id="MPWidgets" src="https://my.woodsidebible.org/widgets/dist/MPWidgets.js"></script>
    <link href="Assets/CustomGroups.css" rel="stylesheet" />
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css">
    <script data-search-pseudo-elements defer src="//use.fontawesome.com/releases/v5.0.7/css/all.css"></script>
    <script id="MPWidgets" src="https://my.woodsidebible.org/widgets/dist/MPWidgets.js"></script>
    <script src="/Widgets/GroupFinder/Assets/FilterDropdowns.js"></script>
    
    
        <script>
            function horizontalScrollOnCarousel() {
                console.log("Checking Carousels");
                const carousels = document.getElementsByClassName("carousel");
                for (let i = 0; i < carousels.length; i++) {
                    console.log(carousels);
                    console.log(i);
                    if (carousels[i].scrollWidth > carousels[i].clientWidth) {
                        carousels[i].classList.add("horizontalScroll");
                    }
                }
            }
            
            document.cookie = "tbx-ws__selected-location=eyJ1c2VyX2lkIjoyMDEsImxvY2F0aW9uX2lkIjo5LCJsb2NhdGlvbl9uYW1lIjoiTGFrZSBPcmlvbiIsImxvY2F0aW9uX3Nob3J0X25hbWUiOiJMTyIsImxvY2F0aW9uX3VybCI6Imh0dHBzOi8vd29vZHNpZGViaWJsZS5vcmcvbG9jYXRpb25zL2xha2Utb3Jpb24ifQ";

            function decodeJwtFromCookie(cookieName) {
                function getCookieValue(name) {
                    const cookies = document.cookie.split('; ');
                    for (let cookie of cookies) {
                        const [key, ...valueParts] = cookie.split('=');
                        if (key.trim() === name) {
                            return decodeURIComponent(valueParts.join('='));
                        }
                    }
                    return null;
                }

                function base64UrlDecode(str) {
                    try {
                        return JSON.parse(atob(str.replace(/-/g, '+').replace(/_/g, '/')));
                    } catch (e) {
                        console.error("Invalid JWT format", e);
                        return null;
                    }
                }

                const token = getCookieValue(cookieName);
                
                if (!token) {
                    console.error("JWT not found in cookies");
                    return null;
                }
                
                return base64UrlDecode(token); // Decode payload
            }

            // Get the Congregation_ID
            const cookieName = "tbx-ws__selected-location";
            let CongregationID = (decodeJwtFromCookie(cookieName).location_id);
            //console.log(CongregationID);


        </script>   
        </head>
    
    <body>
        <div class="container">
            <div id="CustomGroupFinderWidget" 
                data-component="CustomWidget"
                data-sp="api_custom_GroupFinderWidget" 
                data-params="@DomainID=1&@CongregationID=9"
                data-template="/Widgets/GroupFinder/Template/GroupFinder.html" 
                data-requireUser="false" 
                data-cache="false" 
                data-host="woodsidebible" 
                data-debug="true">
            </div>    
        </div>

        <script type="text/javascript" src="https://mpweb.azureedge.net/cdn/customWidget.js"></script>
    </body>
</html>